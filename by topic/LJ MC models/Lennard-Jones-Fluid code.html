<pre><font color="#007f69">globals</font><font color="#000000">[MAX-MOVE-DIST CUTOFF-DIST Vtotal EPS TOTAL-MOVE-ATTEMPTS TOTAL-SUCCESSFUL-MOVES DIAMETER POT-OFFSET CURRENT-MOVE-ATTEMPTS CURRENT-SUCCESSFUL-MOVES]<br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup<br />  </font><font color="#0000aa">clear-all</font><font color="#000000"><br />  </font><font color="#0000aa">reset-ticks</font><font color="#000000"><br />  </font><font color="#0000aa">resize-world</font><font color="#000000"> </font><font color="#963700">-16</font><font color="#000000"> </font><font color="#963700">16</font><font color="#000000"> </font><font color="#963700">-16</font><font color="#000000"> </font><font color="#963700">16</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> EPS </font><font color="#963700">1</font><font color="#000000"><br />  </font><font color="#5a5a5a">;Set the diameter of particles based on density</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> DIAMETER </font><font color="#660096">sqrt</font><font color="#000000">(density </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">world-width</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> </font><font color="#660096">world-height</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> N) </font><font color="#5a5a5a">;This is number density</font><font color="#000000"><br />  </font><font color="#0000aa">crt</font><font color="#000000"> N [<br />    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">shape</font><font color="#000000"> </font><font color="#963700">&quot;circle&quot;</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">size</font><font color="#000000"> (DIAMETER </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> DIAMETER</font><font color="#5a5a5a">;DIAMETER</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"><br />  ]<br />  setup-atoms<br />  </font><font color="#0000aa">set</font><font color="#000000"> MAX-MOVE-DIST DIAMETER<br />  </font><font color="#0000aa">set</font><font color="#000000"> CUTOFF-DIST </font><font color="#963700">2.5</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> DIAMETER<br />  </font><font color="#0000aa">set</font><font color="#000000"> POT-OFFSET (</font><font color="#660096">-</font><font color="#000000"> (</font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> ((DIAMETER </font><font color="#660096">/</font><font color="#000000"> CUTOFF-DIST) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">12</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> (DIAMETER </font><font color="#660096">/</font><font color="#000000"> CUTOFF-DIST) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000">)) )<br />  </font><font color="#0000aa">set</font><font color="#000000"> Vtotal calc-Vtotal<br />  </font><font color="#0000aa">tick</font><font color="#000000"> </font><font color="#5a5a5a">;so that the tune-acceptance rate doesn't get called on first tick</font><font color="#000000"><br /><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> go<br /><br />  </font><font color="#5a5a5a">;Each tick, attempt N moves. On average, every particle moves each tick</font><font color="#000000"><br />  </font><font color="#0000aa">repeat</font><font color="#000000"> N [<br />    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000">[<br />      attempt-move<br />    ]<br />  ]<br /><br />  </font><font color="#5a5a5a">;tune the move distance to adjust the acceptance rate every N ticks</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">ticks</font><font color="#000000"> </font><font color="#660096">mod</font><font color="#000000"> N </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">[<br />    tune-acceptance-rate<br />  ]<br /><br />  </font><font color="#0000aa">tick</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /><br /></font><font color="#007f69">to</font><font color="#000000"> attempt-move<br />  </font><font color="#0000aa">set</font><font color="#000000"> TOTAL-MOVE-ATTEMPTS TOTAL-MOVE-ATTEMPTS </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">  </font><font color="#5a5a5a">;the is the total running average</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> CURRENT-MOVE-ATTEMPTS CURRENT-MOVE-ATTEMPTS </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#5a5a5a">;this is just since the last max-move-distance adjustment</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> Vold calc-V</font><font color="#5a5a5a">; Calculate current energy</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> deltax (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> MAX-MOVE-DIST) </font><font color="#660096">-</font><font color="#000000"> MAX-MOVE-DIST  </font><font color="#5a5a5a">; pick random x distance</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> deltay (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> MAX-MOVE-DIST) </font><font color="#660096">-</font><font color="#000000"> MAX-MOVE-DIST </font><font color="#5a5a5a">; pick random y distance</font><font color="#000000"><br />  </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> deltax) (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> deltay) </font><font color="#5a5a5a">;move the random x and y distances</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> Vnew calc-V </font><font color="#5a5a5a">;Calcualte the new energy</font><font color="#000000"><br /><br />  </font><font color="#0000aa">let</font><font color="#000000"> deltaV Vnew </font><font color="#660096">-</font><font color="#000000"> Vold<br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> (Vnew </font><font color="#660096">&lt;</font><font color="#000000"> Vold) </font><font color="#660096">or</font><font color="#000000"> (</font><font color="#660096">random-float</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">exp</font><font color="#000000">( </font><font color="#660096">-</font><font color="#000000"> deltaV </font><font color="#660096">/</font><font color="#000000"> T) )<br />    [<br />      </font><font color="#0000aa">set</font><font color="#000000"> TOTAL-SUCCESSFUL-MOVES TOTAL-SUCCESSFUL-MOVES </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">   </font><font color="#5a5a5a">;the is the total running average</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> CURRENT-SUCCESSFUL-MOVES CURRENT-SUCCESSFUL-MOVES </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">   </font><font color="#5a5a5a">;this is just since the last max-move-distance adjustment</font><font color="#000000"><br />      </font><font color="#0000aa">set</font><font color="#000000"> Vtotal Vtotal </font><font color="#660096">+</font><font color="#000000"> deltaV<br />      </font><font color="#0000aa">if</font><font color="#000000"> color-energy? [set-color Vnew]<br />    ]<br />    [<br />      </font><font color="#0000aa">setxy</font><font color="#000000"> (</font><font color="#660096">xcor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> deltax) (</font><font color="#660096">ycor</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> deltay) </font><font color="#5a5a5a">;reset position</font><font color="#000000"><br />    ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> set-color [v]<br />  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">color</font><font color="#000000"> </font><font color="#660096">scale-color</font><font color="#000000"> </font><font color="#963700">blue</font><font color="#000000"> v </font><font color="#963700">-10</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> calc-Vtotal<br />  </font><font color="#0000aa">let</font><font color="#000000"> Vtot </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />    </font><font color="#0000aa">set</font><font color="#000000"> Vtot Vtot </font><font color="#660096">+</font><font color="#000000"> calc-V<br />  ]<br />  </font><font color="#0000aa">report</font><font color="#000000"> Vtot </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#5a5a5a">;divide by two because each particle has been counted twice</font><font color="#000000"><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> calc-V<br />  </font><font color="#0000aa">let</font><font color="#000000"> V </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> Vi </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> repel-term </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> attract-term </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">let</font><font color="#000000"> rsquare </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> CUTOFF-DIST [<br />    </font><font color="#5a5a5a">;set rsquare (xcor - [xcor] of myself) ^ 2 + (ycor - [ycor] of myself) ^ 2</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> rsquare (</font><font color="#660096">distance</font><font color="#000000"> </font><font color="#660096">myself</font><font color="#000000">) </font><font color="#660096">^</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"><br />    </font><font color="#0000aa">let</font><font color="#000000"> dsquare DIAMETER </font><font color="#660096">*</font><font color="#000000"> DIAMETER<br />    </font><font color="#0000aa">set</font><font color="#000000"> attract-term (dsquare </font><font color="#660096">*</font><font color="#000000"> dsquare </font><font color="#660096">*</font><font color="#000000"> dsquare)  </font><font color="#660096">/</font><font color="#000000"> (rsquare </font><font color="#660096">*</font><font color="#000000"> rsquare </font><font color="#660096">*</font><font color="#000000"> rsquare)<br />    </font><font color="#0000aa">set</font><font color="#000000"> repel-term attract-term </font><font color="#660096">*</font><font color="#000000"> attract-term<br />    </font><font color="#5a5a5a">;NOTE could do this a little faster by attract-term * (attract-term -1)</font><font color="#000000"><br />    </font><font color="#0000aa">set</font><font color="#000000"> Vi </font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> EPS </font><font color="#660096">*</font><font color="#000000"> (repel-term </font><font color="#660096">-</font><font color="#000000"> attract-term) </font><font color="#660096">+</font><font color="#000000"> POT-OFFSET<br />    </font><font color="#0000aa">set</font><font color="#000000"> V V </font><font color="#660096">+</font><font color="#000000"> Vi<br />  ]<br />  </font><font color="#0000aa">report</font><font color="#000000"> V<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> accept-rate<br />  </font><font color="#0000aa">report</font><font color="#000000"> CURRENT-SUCCESSFUL-MOVES </font><font color="#660096">/</font><font color="#000000"> CURRENT-MOVE-ATTEMPTS<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> tune-acceptance-rate<br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> accept-rate </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">0.5</font><font color="#000000">[<br />    </font><font color="#0000aa">set</font><font color="#000000"> MAX-MOVE-DIST MAX-MOVE-DIST </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">.95</font><font color="#000000"><br />  ][<br />  </font><font color="#0000aa">set</font><font color="#000000"> MAX-MOVE-DIST MAX-MOVE-DIST </font><font color="#660096">*</font><font color="#000000"> </font><font color="#963700">1.05</font><font color="#000000"><br />  </font><font color="#0000aa">if</font><font color="#000000"> MAX-MOVE-DIST </font><font color="#660096">&gt;</font><font color="#000000"> DIAMETER [<br />    </font><font color="#0000aa">set</font><font color="#000000"> MAX-MOVE-DIST DIAMETER<br />  ]<br />  ]<br />  </font><font color="#0000aa">set</font><font color="#000000"> CURRENT-SUCCESSFUL-MOVES </font><font color="#963700">0</font><font color="#000000"><br />  </font><font color="#0000aa">set</font><font color="#000000"> CURRENT-MOVE-ATTEMPTS </font><font color="#963700">0</font><font color="#000000"><br /><br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> energy-per-particle<br />  </font><font color="#0000aa">report</font><font color="#000000"> Vtotal </font><font color="#660096">/</font><font color="#000000"> N<br /></font><font color="#007f69">end</font><font color="#000000"><br /></font><font color="#5a5a5a">;*********SETUP Procedures*************</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> setup-atoms<br />  </font><font color="#0000aa">if</font><font color="#000000"> initial-config </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;hcp&quot;</font><font color="#000000">[<br />    </font><font color="#0000aa">let</font><font color="#000000"> L </font><font color="#660096">sqrt</font><font color="#000000">(N)<br />    </font><font color="#0000aa">let</font><font color="#000000"> row-dist (</font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">^</font><font color="#000000"> (</font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">6</font><font color="#000000">)) </font><font color="#660096">*</font><font color="#000000"> DIAMETER </font><font color="#5a5a5a">;this is the distance with minimum energy</font><font color="#000000"><br />    </font><font color="#0000aa">let</font><font color="#000000"> ypos (</font><font color="#660096">-</font><font color="#000000"> L </font><font color="#660096">*</font><font color="#000000"> row-dist </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)<br />    </font><font color="#0000aa">let</font><font color="#000000"> xpos (</font><font color="#660096">-</font><font color="#000000"> L </font><font color="#660096">*</font><font color="#000000"> row-dist </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)<br />    </font><font color="#0000aa">let</font><font color="#000000"> rnum </font><font color="#963700">0</font><font color="#000000"><br />    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />      </font><font color="#0000aa">if</font><font color="#000000"> xpos </font><font color="#660096">&gt;</font><font color="#000000"> (L </font><font color="#660096">*</font><font color="#000000"> row-dist </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)  [<br />        </font><font color="#0000aa">set</font><font color="#000000"> rnum rnum </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"><br />        </font><font color="#0000aa">set</font><font color="#000000"> xpos (</font><font color="#660096">-</font><font color="#000000"> L </font><font color="#660096">*</font><font color="#000000"> row-dist </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">+</font><font color="#000000"> (rnum </font><font color="#660096">mod</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) </font><font color="#660096">*</font><font color="#000000"> row-dist </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"><br />        </font><font color="#0000aa">set</font><font color="#000000"> ypos ypos </font><font color="#660096">+</font><font color="#000000"> row-dist<br />      ]<br />      </font><font color="#0000aa">setxy</font><font color="#000000"> xpos ypos<br />      </font><font color="#0000aa">set</font><font color="#000000"> xpos xpos </font><font color="#660096">+</font><font color="#000000"> row-dist<br />    ]<br />  ]<br /><br />  </font><font color="#0000aa">if</font><font color="#000000"> initial-config </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;random&quot;</font><font color="#000000">[<br />    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />      </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"><br />    ]<br />  ]<br /><br />  remove-overlap<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /></font><font color="#007f69">to</font><font color="#000000"> remove-overlap<br />  </font><font color="#0000aa">let</font><font color="#000000"> RMIN  </font><font color="#963700">0.7</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> DIAMETER<br />  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> [<br />    </font><font color="#0000aa">while</font><font color="#000000"> [overlapping RMIN] [<br />      </font><font color="#0000aa">setxy</font><font color="#000000"> </font><font color="#660096">random-xcor</font><font color="#000000"> </font><font color="#660096">random-ycor</font><font color="#000000"><br />    ]<br /><br />  ]<br /></font><font color="#007f69">end</font><font color="#000000"><br /><br /><br /></font><font color="#007f69">to-report</font><font color="#000000"> overlapping [RMIN]<br />  </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> </font><font color="#660096">other</font><font color="#000000"> </font><font color="#660096">turtles</font><font color="#000000"> </font><font color="#660096">in-radius</font><font color="#000000"> RMIN<br />  [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">True</font><font color="#000000">]<br />  [</font><font color="#0000aa">report</font><font color="#000000"> </font><font color="#963700">False</font><font color="#000000">]<br /></font><font color="#007f69">end</font>
</pre>
